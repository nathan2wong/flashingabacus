<html>

<head>
    <script src="javascripts/jquery.js"></script>
    <link rel="stylesheet" href="stylesheets/bootstrap.css">
    <script src="javascripts/bootstrap.js"></script>
    <script src="spin.min.js"></script>
    <script src="http://malsup.github.com/jquery.form.js"></script>
        <link rel="stylesheet" href="stylesheets/styles.css">
    <meta name = "description" content="Sample working genomics DNA analysis pipeline of NGSomics. Made by Nathan Wong and Mahesh Murag">
    <script>
        var opts = {
          lines: 7 // The number of lines to draw
        , length: 10 // The length of each line
        , width: 8 // The line thickness
        , radius: 42 // The radius of the inner circle
        , scale: 1 // Scales overall size of the spinner
        , corners: 0 // Corner roundness (0..1)
        , color: '#ffff00' // #rgb or #rrggbb or array of colors
        , opacity: 0.2 // Opacity of the lines
        , rotate: 0 // The rotation offset
        , direction: 1 // 1: clockwise, -1: counterclockwise
        , speed: 2 // Rounds per second
        , trail: 50 // Afterglow percentage
        , fps: 20 // Frames per second when using setTimeout() as a fallback for CSS
        , zIndex: 2e9 // The z-index (defaults to 2000000000)
        , className: 'spinner' // The CSS class to assign to the spinner
        , top: '50%' // Top position relative to parent
        , left: '50%' // Left position relative to parent
        , shadow: false // Whether to render a shadow
        , hwaccel: false // Whether to use hardware acceleration
        , position: 'relative' // Element positioning
        };

        $(document).ready(function () {


            $("#run11").click(function () {
                $("#sam_display").html("");
            });

            $("#run22").click(function () {
                $("#process_display").html("");
            });
            var spinner;
//            $('#uploadForm').beforeSubmit(function(arr, form, options){
//                spinner = new Spinner(opts).spin(document.getElementById('spin1'));
//            });
            $("#uploadForm").submit(function(event){
                spinner = new Spinner(opts).spin(document.getElementById('spin1'));
            });
            var vcf_out = "",
                variants_out = "",
                drug_out = "";
            $("#run21").click(function(){
                $("#vcf_display").html(vcf_out);
            });
            $("#run22").click(function () {
                $("#vcf_display").html("");
            });
            $("#run31").click(function(){
                $("#variants_display").html(variants_out);
            });
            $("#run32").click(function () {
                $("#variants_display").html("");
            });
            $("#run41").click(function(){
                $("#drug_display").html(drug_out);
            });
            $("#run42").click(function () {
                $("#drug_display").html("");
            });
            $('#uploadForm').ajaxForm(function(obj, statusText, xhr, formElement) {
                $("#sam_display").html(obj.sam_output);
                vcf_out = obj.vcf_output;
                variants_out = obj.variants_output;
                drug_out = obj.drug_output;
                $("#download_sam").attr({"href": "" + obj.links.sam}); ----- .txt? with names?
                $("#download_vcf").attr({"href": "" + obj.links.vcf});
                $("#download_variants").attr({"href": "" + obj.links.variants});
                console.log(obj.links);
                $("#run11").prop('disabled', false);
                $("#run21").prop('disabled', false);
                $("#run22").prop('disabled', false);
                $("#run31").prop('disabled', false);
                $("#run32").prop('disabled', false);
                $("#run41").prop('disabled', false);
                $("#run42").prop('disabled', false);
                spinner.stop();
//                console.log(statusText)
//                console.log(xhr)
//                console.log(formElement)
                alert("Upload successful!");
            });
        });
    </script>
    <script type="text/javascript">
  <!--
  if (screen.width <= 800) {
    location.href = "mobile.html";
  }
  //-->
</script>
</head>

<body>
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="http://ngsomics.com">NGSomics: &nbsp; Application</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li>    <a href="#menu-toggle" id="menu-toggle">Toggle Upload Menu</a>
</li>
        <li class="active"><a href="#">Application</a><span class="sr-only">(current)</span></li>
          <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Download Sample Data <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="http://ngsomics.com/SampleNC_008253.tar">SampleNC_008253.1DataSet</a></li>
          </ul>
          </li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li class="disabled"><a href="#">Sign-in</a></li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Sign Up <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li class="disabled"><a href="#">User Accounts</a></li>
            <li><a href="http://bit.ly/ngsomicsreport">Sample Reports</a></li>
            <li role="separator" class="divider"></li>
            <li><a href="mailto:nathan2wong@gmail.com">Get in Touch</a></li>
          </ul>
        </li>
      </ul>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
<div class="function">
    <div id="wrapper">
    <div id="sidebar-wrapper">
            <ul class="sidebar-nav">
                <li class="sidebar-brand" style="font-size:30px; font-weight:bold;" >
File Upload
                </li>
                <hr>
                <form ref='uploadForm'
			id='uploadForm'
			action='http://159.203.206.184:8081/file-upload'
			method='post'
			encType="multipart/form-data">
                    <li style = "text-align:left;">Reference file (fasta):	<input style="display: inline;" type="file" name="ref" accept=".fasta"/></li>
                    <li style = "text-align:left">Binary Alignment File (BAM):	<input style="display: inline;"  type="file" name="bam" accept=".bam"/></li>
                    <!--<li style="text-align:left">Raw sequence file 2 (fastq.gz):	<input style="display: inline;"  type="file" name="fastq2" accept=".gz,.fastq,.fq"/></li>-->
                    <hr>
                    <div id = "upload"><input type='submit' value='Upload!' style='height:60; width:100' /></div>
    </form>
                <div id="spin1"></div>
            </ul>
        </div>
    </div>
    <div id = "content">
    <div class="panel panel-defult">
        <div class = "panel-body"><h1>SAM Output</h1>
        </div>
    <button id="run11" disabled>Clear SAM File Output</button>
        <a href="#" id="download_sam">Download</a>
    <div id="sam_display"></div>

        <div class="panel-body"><h1>VCF File Display</h1></div>
    <button id="run21" disabled>Show VCF File</button>
    <button id="run22" disabled>Clear Process Output</button>
        <a href="#" id="download_vcf">Download</a>
    <div id="vcf_display"></div>

        <div class="panel-body"><h1>Final Variants Calls Display</h1></div>
    <button id="run31" disabled>Show Variants File</button>
    <button id="run32" disabled>Clear Variants Output</button>
        <a href="#" id="download_variants">Download</a>
    <div id="variants_display"></div>

        <div class="panel-body"><h1>Drug Correlation Display</h1></div>
    <button id="run41" disabled>Show Drug File</button>
    <button id="run42" disabled>Clear Drug Output</button>
        <a href="#" id="download_drugs">Download</a>
    <div id="drug_display"></div>
        </div>
    </div>
    </div>
    <script src="javascripts/appga.js" type="text/javascript"></script>
<script>
    $("#menu-toggle").click(function(e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
        $("#content").toggleClass("toggled");
    });
    </script>
    </body>
</html>
